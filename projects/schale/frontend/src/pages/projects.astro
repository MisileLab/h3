---
import Base from "../components/base.astro"
---

<Base>
  <Fragment slot="head">
    <title>Projects</title>
    <script>
      import { isMobileOnly } from "mobile-device-detect";
      import { queryId, nullVerify } from "@misile/satellite";

      interface Project {
        description: string;
        url: string;
        stacks: string[];
      }

      function displayProject(project: string) {
        const p = projects[project];
        queryId("description").innerText = p.description;
        queryId("stacks").innerText = p.stacks.join(", ");
        (queryId("clicktogo") as HTMLAnchorElement).innerText = "View Source";
        (queryId("clicktogo") as HTMLAnchorElement).href = p.url;
      }

      const projects: Record<string, Project> = {
        "ignofier+": {
          description: "Fast gitignore generator",
          url: "https://github.com/misilelab/ignofierplus",
          stacks: ["rust"]
        },
        "klojure": {
          description: "Search koreanbots with multiple keywords",
          url: "https://github.com/lawnseol/klojure",
          stacks: ["python", "sqlite"],
        },
        "sntapi": {
          description: "Sunrint school meal api",
          url: "https://github.com/MisileLab/h3/tree/78c1d37ace0c612915e44e91e6cfec38d7842508/archives/sntapi",
          stacks: ["python"]
        },
        "calendar": {
          description: "Simple calendar",
          url: "https://github.com/misilelab/calendar",
          stacks: ["solidjs", "tailwindcss", "tauri", "rust"]
        },
        "lambda": {
          description: "The simplest form",
          url: "https://github.com/MisileLab/h3/tree/a13896cca09c5a93d9a98673e908a6e62df893c2/archives/lambda",
          stacks: ["solidjs", "tailwindcss", "python", "fastapi", "graphql"]
        },
        "butter": {
          description: "The ai assistant that can search, listen, and say with voice",
          url: "https://github.com/misilelab/butter",
          stacks: ["python"]
        },
        "schale": {
          description: "The monolithic website and backend (this website)",
          url: "https://github.com/MisileLab/h3/tree/main/projects/schale",
          stacks: ["fastapi", "python", "tailwindcss", "astrojs"]
        },
        "slunchv2-backend": {
          description: "The backend of slunchv2(nyl)",
          url: "https://github.com/ny0510/slunchv2-backend",
          stacks: ["fastapi", "python", "gel"]
        },
        "scholub-backend": {
          description: "The backend of scholub",
          url: "https://github.com/scholub/backend",
          stacks: ["fastapi", "python", "gel"]
        }
      }
      const keys = Object.keys(projects).toReversed()

      let first = true
      for (const i of keys) {
        const o = document.createElement('option')
        o.value = i
        o.innerText = i
        if (first) {
          o.selected = true
          first = !first
        }
        queryId("select").appendChild(o)
      }

      if (isMobileOnly) {
        const d = document.createElement("span");
        d.innerText = "Click = Open with new tab"
        queryId("mobile-div").prepend(d);
        queryId("select").addEventListener("change", (e)=>{
          window.open(projects[(nullVerify(e.target) as HTMLOptionElement).value].url, "_blank");
        })
      } else {
        queryId("select").addEventListener("change", (e)=>{
          if ((nullVerify(e.target) as HTMLSelectElement).value === "") {return;}
          displayProject((nullVerify(e.target) as HTMLOptionElement).value);
        })
      }
      displayProject(keys[0])
    </script>
  </Fragment>
  <!-- Navigation Header -->
  <header class="border-b border-gray-800">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center h-16">
        <div class="flex items-center space-x-8">
          <a href="/" class="text-xl font-bold text-white">Misile</a>
          <nav class="hidden md:flex space-x-6">
            <a href="/projects" class="text-white">Projects</a>
            <a href="/en/blog" class="text-gray-300 hover:text-white transition-colors">Blog</a>
            <a href="/contact" class="text-gray-300 hover:text-white transition-colors">Contact</a>
          </nav>
        </div>
        <div class="flex items-center space-x-4">
          <a href="https://mail.misile.xyz" class="text-gray-300 hover:text-white transition-colors">Subscribe</a>
          <div class="flex items-center space-x-2 text-gray-400 cursor-pointer" id="crypto">
            <span>Donate</span>
            <span class="bg-gray-900 text-gray-300 px-2 py-1 rounded text-sm">XMR</span>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="min-h-screen px-4 py-12">
    <div class="max-w-6xl mx-auto">
      <h1 class="text-4xl md:text-5xl font-bold text-white text-center mb-12">Projects</h1>
      
      <div class="flex flex-col items-center justify-center gap-8">
        <div class="w-full max-w-2xl">
          <select id="select" class="w-full bg-gray-900 text-gray-300 border border-gray-700 rounded-lg px-4 py-3 text-lg focus:outline-none focus:border-gray-600"></select>
        </div>
        
        <div class="w-full max-w-2xl bg-gray-900 border border-gray-800 rounded-lg p-8">
          <div class="space-y-4">
            <div>
              <h3 class="text-lg font-semibold text-gray-400 mb-2">Description</h3>
              <p id="description" class="text-white text-lg"></p>
            </div>
            <div>
              <h3 class="text-lg font-semibold text-gray-400 mb-2">Tech Stack</h3>
              <p id="stacks" class="text-white text-lg"></p>
            </div>
            <div>
              <a id="clicktogo" class="inline-flex items-center text-blue-400 hover:text-blue-300 transition-colors" target="_blank">
                <span>View Source</span>
                <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                </svg>
              </a>
            </div>
          </div>
        </div>
        
        <div id="mobile-div" class="text-gray-400 text-sm"></div>
      </div>
    </div>
  </main>
</Base>
